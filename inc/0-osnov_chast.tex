\section{Алгоритмы Генерации Доменных Имен}\label{dga}
Алгоритмы Генерации Доменных Имен (DGA) представляют собой алгоритмы, используемые вредоносным программным обеспечением (malware) для генерации большого количества псевдослучайных доменных имен, которые позволят им установить соединение с управляющим командным центром. Тем самым они обеспечивают мощный слой защиты инфраструктуры для вредоносных программ. С первого взгляда концепция создания большого количества доменных имен для установки связи кажется не сложной, но методы, используемые для создания произвольных строк часто скрываются за разными слоями обфускации. Это делается для усложнения процесса обратной разработки и получения модели функционирования того или иного семейства алгоритмов. Рассмотрим общие принципы работы таких алгоритмов.
    \subsection{Общие принципы работы}\label{work_princip}
        Общий принцип работы представлен на рис \ref{dga_work}. В общем случае вредоносному файлу необходим какой-либо параметр для инициализации Генератора Псевдослучайных Чисел (ГСПЧ). В качестве этого параметра может выступать любой параметр, который будет известен вредоносному файлу и владельцу ботнета. В нашем случае - это значение текущей даты и времени. Вредоносный файл, используя протокол HTTP посылает запрос на сайт cnn.com. В ответ на этот запрос cnn.com возвращает в заголовках HTTP ответа текущие время и дату в формате GMT. Владелец ботнета таким же способом получает текущее время и дату в формате GMT. Далее, это значение, попадает в сам алгоритма генерации доменных имен, инициализируя ГСПЧ, который может иметь вид например Линейного конгруэнтного генератора или  Регистра сдвига с обратной связью. Поэтому, используя одинаковые вектора инициализации, вредоносный файл и владелец ботнета получают идентичные таблицы доменных имен.
        После этого владельцу ботнета достаточно зарегистрировать лишь один домен, для того, чтобы вредоносный файл, рекурсивно посылая запросы к DNS серверу получил IP адрес управляющего сервера для дальнейшей установки с ним соединения и получения, выполнения команд.
        \addimghere{images/dga_work}{0.6}{Общий принцип работы}{dga_work}
    \subsection{Рассмотренные алгоритмы}
    В ходе выполнения данной работы были проанализированы 8 разновидностей алгоритмов генерации доменных имен, а именно: Conficker, Cryptolocker, Ramdo, PushDo, Zeus, Tinba, Rovnix, Matsnu. Для каждого из них, путём обратной разработки были составлены модели работы алгоритмов генерации доменных имен и реализованы на языках программирования высокого уровня. Далее в работе представлены описание и особенности работы каждого из этих алгоритмов.

Conficker - вирус, впервые появившийся в 2008 году, использующий для заражения машин популярную уязвимость MS08-067. Одним из первых применил технику DGA. Процесс генерации доменного имени можно описать пятью шагами, как показано на рис \ref{conficker_dga} и его архитектура идентична принципу, описанному в части \ref{work_princip}.
\addimghere{images/conficker}{0.4}{Принцип работы conficker DGA}{conficker_dga}

Cryptolocker - имя вредоносных программ вида троян-вымогатель (ransomware). Целью данного вируса являются системы Microsoft Windows. Cryptolocker полностью шифрует содержимое файловой системы жертвы и требует заплатить выкуп для получения ключа дешифрования.
DGA, который использует cryptolocker относительно прост, однако использует множество приемов, которые осложняют процесс его обратной разработки. Его алгоритм использует для инициализации 4 значения - ключ, день, месяц, год.
Ключ может быть константой или рассчитываться по формуле:
\begin{lstlisting}
key = (((key * 0x10624DD3) >> 6) * 0xFFFFFC18)+ key)
\end{lstlisting}
В данной работе за значение ключа взята константа 0x41.
Дата, месяц, год инициализируются соответственно формулам:
\begin{lstlisting}
date = ((date<<13 & 0xFFFFFFFF)>>19 & 0xFFFFFFFF) ^ ((date>>1 & 0xFFFFFFFF)<<13 & 0xFFFFFFFF) ^ (date>>19 & 0xFFFFFFFF);
month = ((month<<2 & 0xFFFFFFFF)>>25 & 0xFFFFFFFF) ^ ((month>>3 & 0xFFFFFFFF)<<7 & 0xFFFFFFFF) ^ (month>>25 & 0xFFFFFFFF);
year = ((year<<3 & 0xFFFFFFFF)>>11 & 0xFFFFFFFF) ^ ((year>>4 & 0xFFFFFFFF)<<21 & 0xFFFFFFFF) ^ (year>>11 & 0xFFFFFFFF);
\end{lstlisting}
Каждый символ рассчитывается по формуле:
\begin{lstlisting}
chr(ord('a') + (year ^ month ^ date) % 25);
\end{lstlisting}
А длина составляет доменного имени составляет:
\begin{lstlisting}
date>>3 ^ year>>8 ^ year>>11 & 3 + 12
\end{lstlisting}
В конце генерации доменного имени добавляется домен верхнего уровня, который последовательно выбирается из массива зашитых значений.

PushDo - второй по величине ботнет, впервые появившийся в 2007 году. Для установки связи с командным сервером использует два механизма. Первый - зашитые доменные имена, и второй - DGA. Второй механизм имеет четыре составляющие, а именно - системное время, вектор инициализации, функцию хеширования MD5 и сам генератор доменных имен. Каждый день, при генерации первого доменного имени DGA вектору инициализации присваивается значение системного времени, которое получается путем вызова WINAPI функции GetLocalTime, операций битового сдвига и XOR - функция шифрования. После этого вектор инициализации попадает на вход функции хеширования MD5, вывод которой в свою очередь подает в генератор доменного имени и вектор инициализации генерации следующего доменного имени. Однако вектор инициализации следующего доменного имени берет не весь вывод функции MD5, а лишь первые её 4 байта. Схема работы этого алгоритма генерации доменных имен представлена на рис \ref{PushDo}.
\addimghere{images/PushDo}{0.6}{Принцип работы PushDo DGA}{PushDo}
Отдельно стоит рассмотреть генератор доменного имени из вывода функции MD5. Каждый экземпляр такого генератора имеет четыре уникальных строки. Это позволяет обновлять генератор с каждой новой версий ботнета или иметь множество непересекающихся ботнетов одного и того же типа. Сначала генератор вычисляет длину доменного имени. Она рассчитывается делением первых четырех байт на 4 и лежит в пределах от 9 до 12. Далее специальный цикл, используя остаток от деления переводит вывод функции MD5 в читаемое доменное имя и добавляет к нему домен верхнего уровня. В итоге, всего, каждый день PushDo DGA генерирует 30 доменных домен, зависящих не только от системного времени, но и от зашитых значений специальных строк генератора.

Zeus - семейство вредоносных программ, ворующих аутентифицирующие данные, которое впервые появилось в 2007 году. Первые два варианта этого ботнета базировались на зашитых централизованных адресах управляющих серверов. Эти сервера постоянно отслеживались и отключались при помощи антивирусных компаний и центров реагирования на инциденты информационной безопасности. Именно поэтому, в 2011 году было обнаружено появление новой версии этого ботнета, который использует одноранговые сети и DGA для защиты своей инфраструктуры. В первую очередь защита построена на одноранговых сетях, однако если все зараженные машины не отвечают, то используется DGA. Схема его реализация схожа с алгоритмом, используемом в ботнете PushDo. Алгоритм также использует системное время, алгоритм хеширования MD5 и генератор доменного имени. Однако в отличии от PushDo системное время является вектором инициализации для всех 1000 доменных имен генерируемых каждую неделю, а номер доменного имени является параметром salt (соль) в функции хеширования MD5. Генератор доменного имени можно представить в виде следующего псевдокода.
\begin{lstlisting}
hash = MD5(time+salt)
name = ""
for (j = 0; j < len(hash); j++) {
    c1 = (hash[j] & 0x1F) + ’a’;
    c2 = (hash[j] / 8) + ’a’;
    if(c1 != c2 && c1 <= ’z’) name += c1;
    if(c1 != c2 && c2 <= ’z’) name += c2;
}
\end{lstlisting}

Семейство Ramdo, впервые обнаруженное в декабре 2013 года кардинально отличается от других ботнетов. Ramdo используют множество приемов антиотладки, а также использует технологию double flux (рис \ref{double_flux}) для установки соединения с управляющими серверами. Несмотря на сложность обратной разработки данный ботнет имеет достаточно простой и небольшой DGA, который основывается на зашитой константе и итераторе, основанного на регистре сдвига и булевой операции исключающее или. Для формализации модели DGA данного семейства в работе использован исходный код из работы [15]. Кроме этого идентичную модель DGA использует и Tinba, более известный как Tiny Banker.  Основное отличие лишь в том, что для генерации следующего доменного имени Tinba использует также зашитый первоначальный адрес управляющего сервера.
%%%%\addimghere{images/double_flux.pdf}{0.6}{Технология double flux}{double_flux.pdf}

Бурное развитие методов идентификации и фильтрации вредоносных доменных имен привело к развитию новых видов DGA. Такими примерами являются алгоритмы генерации доменных имен ботнетов Rovnix и Matsnu. Их алгоритмы проектировались специально для обхода систем идентификации, построенных на количественной оценки энтропии доменного имени или лингвистических моделях, например n-gramm. Rovnix первым из ботнетов предложил использовать специально заготовленный текст для генерации доменного имени. В качестве такого текста Rovnix использует Декларацию о независимости США. На основе системного времени Rovnix выбирает слова из данного текста и конкатенирует их, для достижения определенной длины. Ботнет Matsnu имеет схожий подход, вредоносная программа использует два зашитых словаря, один из которых содержит существительные, а второй глаголы. Тем самым, основываясь на системном времени алгоритм генерации доменного имени выбирает существительное, а затем выбирает глаголы, для достижения необходимой длины доменного имени. Стоит отметить, что подходы этих двух ботнетов действительно с легкостью обходят системы идентификации, основанные лишь на энтропийной оценке, поэтому для идентификации этих классов вредоносных доменных имен требуются более сложные модели, описанные в главах \ref{be_class_exp} и \ref{lstm_class_exp}.
\clearpage

\section{Существующие подходы к классификации}\label{be_class}
В данной главе рассматриваются теоретические основы существующих подходов классификации вредоносных доменных имен. Их реализация и результаты их работы представлены в части \ref{be_class_exp}.
    \subsection{Naive Bayes}
    \subsection{Logistic Regression}
    \subsection{Random Forest}
    \subsection{Extra Tree Forest}
    \subsection{Voting Classification}
\clearpage

\section{Нейронные сети}
    \subsection{Рекуррентные нейронные сети}
    \subsection{LSTM}
    \subsection{Biderectial LSTM}
    \subsection{Механизм внимания}
\clearpage

\section{Эксперимент}
    \subsection{Существующие подходы}\label{be_class_exp}
    \subsection{Результаты LSTM}\label{lstm_class_exp}
    \subsection{Сравнительный анализ}
\clearpage